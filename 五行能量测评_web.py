import streamlit as st

# ---------------------- æ ¸å¿ƒé…ç½® ----------------------
QUESTIONS = {
    1: ["å¿ƒè·³çªç„¶åŠ å¿«ï¼Œæ„Ÿè§‰å¿ƒæ…Œæ…Œçš„", "ç«èƒ½é‡è¿‡å¼±"],
    2: ["èƒ¸å£æ€»æ˜¯è§‰å¾—æ€•å†·ï¼Œéœ€è¦é¢å¤–æ‚çƒ­", "ç«èƒ½é‡è¿‡å¼±"],
    3: ["æ²¡æ´»åŠ¨ä¹Ÿçˆ±å‡ºè™šæ±—ï¼Œæµ‘èº«æ²¡åŠ›æ°”", "ç«èƒ½é‡è¿‡å¼±"],
    4: ["å¤œé‡Œç¡è§‰å®¹æ˜“é†’ï¼Œé†’åå¿ƒæ…Œéš¾å…¥ç¡", "ç«èƒ½é‡è¿‡å¼±"],
    5: ["å¿ƒé‡Œçƒ¦èºä¸å®‰ï¼Œæ§åˆ¶ä¸ä½çš„å¿ƒçƒ¦", "ç«èƒ½é‡è¿‡å¼º"],
    6: ["èˆŒå°–å‘çº¢ï¼Œåå¤é•¿å£è…”æºƒç–¡ã€å£èˆŒç”Ÿç–®", "ç«èƒ½é‡è¿‡å¼º"],
    7: ["æ‰‹å¿ƒè„šå¿ƒå‘çƒ­ï¼Œæ€»è§‰å¾—å¿ƒé‡Œç‡¥çƒ­", "ç«èƒ½é‡è¿‡å¼º"],
    8: ["å®¹æ˜“è«åç„¦è™‘ï¼Œä¸€ç‚¹å°äº‹å°±åç«‹éš¾å®‰", "ç«èƒ½é‡è¿‡å¼º"],
    9: ["èƒ¸å£ä¸¤ä¾§èƒ€ç—›ï¼Œæƒ…ç»ªä¸å¥½æ—¶æ›´æ˜æ˜¾", "æœ¨èƒ½é‡è¿‡å¼±"],
    10: ["å°è…¹éƒ¨å†·ç—›ã€å èƒ€ï¼Œçƒ­æ•·åä¼šç¼“è§£", "æœ¨èƒ½é‡è¿‡å¼±"],
    11: ["æƒ…ç»ªä½è½æ²¡ç²¾ç¥ï¼Œå¯¹ä»€ä¹ˆäº‹éƒ½æä¸èµ·åŠ²", "æœ¨èƒ½é‡è¿‡å¼±"],
    12: ["æ‰‹è„šå‘éº»ï¼Œç­‹è„‰å‘ç´§ï¼Œå¤©å†·æ—¶åŠ é‡", "æœ¨èƒ½é‡è¿‡å¼±"],
    13: ["çœ¼ç›å¹²æ¶©ã€å‘ç–¼ï¼Œçœ‹ä¸œè¥¿å®¹æ˜“æ¨¡ç³Š", "æœ¨èƒ½é‡è¿‡å¼º"],
    14: ["èƒ¸å£ä¸¤ä¾§éšéšç¼ç—›ï¼Œå®¹æ˜“æ€¥èºå‘è„¾æ°”", "æœ¨èƒ½é‡è¿‡å¼º"],
    15: ["å¤´æ™•çœ¼èŠ±ã€è€³æœµå—¡å—¡å“ï¼Œå¶å°”æ‰‹è„šæŠ½åŠ¨", "æœ¨èƒ½é‡è¿‡å¼º"],
    16: ["å£å¹²å’½ç‡¥ï¼Œå˜´å”‡å¹²è£‚ï¼Œå¤œé‡Œç¡è§‰å¤šæ¢¦", "æœ¨èƒ½é‡è¿‡å¼º"],
    17: ["è…¹éƒ¨å†·ç—›ï¼Œå–œæ¬¢ç”¨çƒ­æ°´è¢‹æ‚è‚šå­", "åœŸèƒ½é‡è¿‡å¼±"],
    18: ["å¤§ä¾¿ç¨€çƒ‚ä¸æˆå½¢ï¼Œåƒç‚¹å‡‰çš„å°±æ‹‰è‚šå­", "åœŸèƒ½é‡è¿‡å¼±"],
    19: ["æ²¡èƒƒå£ä¸æƒ³åƒé¥­ï¼Œé¥­åè‚šå­èƒ€å¾—å‰å®³", "åœŸèƒ½é‡è¿‡å¼±"],
    20: ["èº«ä½“ä¹åŠ›æ‡’å¾—è¯´è¯ï¼Œè„¸ä¸Šå‘é»„æ²¡æ°”è‰²", "åœŸèƒ½é‡è¿‡å¼±"],
    21: ["è‚šå­éšéšç¼ç—›ï¼Œé¥¿äº†ä¹Ÿä¸æƒ³åƒä¸œè¥¿", "åœŸèƒ½é‡è¿‡å¼º"],
    22: ["å¤§ä¾¿å¹²ç»“åƒç¾Šå±ï¼Œæ’ä¾¿ç‰¹åˆ«å›°éš¾", "åœŸèƒ½é‡è¿‡å¼º"],
    23: ["åƒä¸€ç‚¹æ¸©çƒ­çš„ä¸œè¥¿ï¼Œå°±è§‰å¾—ä¸Šç«éš¾å—", "åœŸèƒ½é‡è¿‡å¼º"],
    24: ["é•¿æœŸå£å¹²ï¼Œå–æ°´ä¹Ÿåªèƒ½çŸ­æš‚ç¼“è§£", "åœŸèƒ½é‡è¿‡å¼º"],
    25: ["å’³å—½æ²¡åŠ›æ°”ï¼Œç—°æ˜¯ç™½è‰²çš„ã€æ¯”è¾ƒç¨€", "é‡‘èƒ½é‡è¿‡å¼±"],
    26: ["åèƒŒç‰¹åˆ«æ€•å†·ï¼Œä¸€å¹å†·é£å°±æ„Ÿå†’", "é‡‘èƒ½é‡è¿‡å¼±"],
    27: ["è¯´è¯å£°éŸ³ä½å¾®ï¼Œç¨å¾®æ´»åŠ¨å°±æ°”å–˜åå", "é‡‘èƒ½é‡è¿‡å¼±"],
    28: ["å…ç–«åŠ›å·®ï¼Œä¸€å¹´å››å­£åå¤æ„Ÿå†’", "é‡‘èƒ½é‡è¿‡å¼±"],
    29: ["å¹²å’³æ²¡æœ‰ç—°ï¼Œæˆ–ç—°å°‘é»è…»éš¾å’³å‡ºæ¥", "é‡‘èƒ½é‡è¿‡å¼º"],
    30: ["å’½å–‰å¹²ç—›ã€å£°éŸ³å˜¶å“‘ï¼Œæ€»è§‰å¾—æœ‰å¼‚ç‰©", "é‡‘èƒ½é‡è¿‡å¼º"],
    31: ["ä¸‹åˆè„¸é¢Šå‘çº¢ï¼Œå¤œé‡Œç¡è§‰å·å·å‡ºæ±—", "é‡‘èƒ½é‡è¿‡å¼º"],
    32: ["ç§‹å†¬å­£èŠ‚ï¼Œé¼»è…”å¹²ç‡¥å®¹æ˜“å‡ºè¡€", "é‡‘èƒ½é‡è¿‡å¼º"],
    33: ["è…°å’Œè†ç›–é…¸è½¯å†·ç—›ï¼Œä¸‹è‚¢ç‰¹åˆ«æ€•å†·", "æ°´èƒ½é‡è¿‡å¼±"],
    34: ["å°ä¾¿æ¸…ç¨€é‡å¤šï¼Œå¤œé‡Œé¢‘ç¹èµ·å¤œä¸Šå•æ‰€", "æ°´èƒ½é‡è¿‡å¼±"],
    35: ["ç²¾ç¥èé¡æ€»æƒ³ç¡è§‰ï¼Œæµ‘èº«æä¸èµ·åŠ²", "æ°´èƒ½é‡è¿‡å¼±"],
    36: ["å¤©ä¸äº®å°±æ‹‰è‚šå­ï¼Œå¤§ä¾¿æœ‰æœªæ¶ˆåŒ–é£Ÿç‰©", "æ°´èƒ½é‡è¿‡å¼±"],
    37: ["è…°å’Œè†ç›–é…¸ç—›æ— åŠ›ï¼Œè®°å¿†åŠ›æ˜æ˜¾ä¸‹é™", "æ°´èƒ½é‡è¿‡å¼º"],
    38: ["ä¸‹åˆèº«ä½“æ½®çƒ­ï¼Œæ‰‹å¿ƒè„šå¿ƒä¸€ç›´å‘çƒ­", "æ°´èƒ½é‡è¿‡å¼º"],
    39: ["å¤±çœ å¤šæ¢¦æ˜“é†’ï¼Œç¡è§‰è´¨é‡ç‰¹åˆ«å·®", "æ°´èƒ½é‡è¿‡å¼º"],
    40: ["å£å¹²å’½ç‡¥å°ä¾¿é»„ï¼Œå¤´å‘æ—©ç™½è¿˜å®¹æ˜“æ‰", "æ°´èƒ½é‡è¿‡å¼º"],
}

TAG_GROUPS = {
    "ç«èƒ½é‡è¿‡å¼±": [1,2,3,4],
    "ç«èƒ½é‡è¿‡å¼º": [5,6,7,8],
    "æœ¨èƒ½é‡è¿‡å¼±": [9,10,11,12],
    "æœ¨èƒ½é‡è¿‡å¼º": [13,14,15,16],
    "åœŸèƒ½é‡è¿‡å¼±": [17,18,19,20],
    "åœŸèƒ½é‡è¿‡å¼º": [21,22,23,24],
    "é‡‘èƒ½é‡è¿‡å¼±": [25,26,27,28],
    "é‡‘èƒ½é‡è¿‡å¼º": [29,30,31,32],
    "æ°´èƒ½é‡è¿‡å¼±": [33,34,35,36],
    "æ°´èƒ½é‡è¿‡å¼º": [37,38,39,40],
}

# ---------------------- æ ¸å¿ƒè¿ç®—é€»è¾‘ ----------------------
def calculate_result(answers):
    tag_scores = {tag: 0 for tag in TAG_GROUPS.keys()}
    for tag, qnos in TAG_GROUPS.items():
        for qno in qnos:
            tag_scores[tag] += answers.get(qno, 1)

    element_results = {}
    elements = ["ç«", "æœ¨", "åœŸ", "é‡‘", "æ°´"]
    for ele in elements:
        weak_score = tag_scores[f"{ele}èƒ½é‡è¿‡å¼±"]
        strong_score = tag_scores[f"{ele}èƒ½é‡è¿‡å¼º"]

        if weak_score >= 8 and (weak_score - strong_score) >= 2:
            element_results[ele] = {"ç±»å‹": "èƒ½é‡è¿‡å¼±", "å¾—åˆ†": weak_score}
        elif strong_score >= 8 and (strong_score - weak_score) >= 2:
            element_results[ele] = {"ç±»å‹": "èƒ½é‡è¿‡å¼º", "å¾—åˆ†": strong_score}
        elif weak_score >= 8 or strong_score >= 8:
            element_results[ele] = {"ç±»å‹": "èƒ½é‡è¿‡å¼±", "å¾—åˆ†": max(weak_score, strong_score)}
        else:
            element_results[ele] = {"ç±»å‹": "èƒ½é‡å¹³è¡¡", "å¾—åˆ†": 0}

    biased_elements = [(ele, res) for ele, res in element_results.items() if res["ç±»å‹"] != "èƒ½é‡å¹³è¡¡"]
    biased_elements.sort(key=lambda x: x[1]["å¾—åˆ†"], reverse=True)

    result_text = "### äº”è¡Œèƒ½é‡çŠ¶æ€æµ‹è¯„ç»“æœ\n\n"
    if not biased_elements:
        result_text += "âœ… ä½ çš„äº”è¡Œèƒ½é‡æš‚æ—¶å¤„äºå¹³è¡¡çŠ¶æ€ï¼Œèº«ä½“åŸºç¡€çŠ¶å†µè‰¯å¥½ï¼\n"
    else:
        result_text += "ğŸ” ä½ çš„èº«ä½“èƒ½é‡å·²å‡ºç°æ˜æ˜¾åé¢‡ï¼ˆæŒ‰é—®é¢˜ä¼˜å…ˆçº§æ’åºï¼‰ï¼š\n"
        for i, (ele, res) in enumerate(biased_elements[:3], 1):
            result_text += f"{i}. {ele}ï¼š{res['ç±»å‹']}ï¼ˆé£é™©å¾—åˆ†ï¼š{res['å¾—åˆ†']}ï¼‰\n"

        if len(biased_elements) > 3:
            result_text += "\nğŸŸ¡ å…¶ä»–èƒ½é‡åé¢‡é—®é¢˜ï¼š\n"
            for ele, res in biased_elements[3:]:
                result_text += f"- {ele}ï¼š{res['ç±»å‹']}ï¼ˆé£é™©å¾—åˆ†ï¼š{res['å¾—åˆ†']}ï¼‰\n"

    result_text += """
\nğŸ“Œ é‡è¦è°ƒå…»æé†’ï¼š
ä½ æ£€æµ‹å‡ºçš„èƒ½é‡åé¢‡ï¼Œå¯èƒ½ç›®å‰åªè¡¨ç°å‡ºè½»è¡¨ç°ï¼Œè¿˜æ²¡å‡ºç°æ˜æ˜¾çš„èº«ä½“ä¸é€‚ï¼Œä½†è¿™å·²ç»æ˜¯èº«ä½“å‘å‡ºçš„**é¢„è­¦ä¿¡å·**ï¼
è¿™äº›åé¢‡ä¸æ˜¯éè¦ç­‰åˆ°å‡ºç°ä¸¥é‡é—®é¢˜ï¼ˆæ¯”å¦‚å®«å¯’ã€é»‘çœ¼åœˆã€ä¸¥é‡å¤±çœ ï¼‰æ‰éœ€è¦è°ƒç†ï¼Œåè€Œç°åœ¨æ­£æ˜¯é¢„é˜²çš„æœ€ä½³æ—¶æœºã€‚
å¦‚æœç°åœ¨ä¸åŠæ—¶å¹²é¢„ï¼Œéšç€æ—¶é—´æ¨ç§»ï¼Œèƒ½é‡åé¢‡ä¼šè¶Šæ¥è¶Šä¸¥é‡ï¼Œæœ€ç»ˆå¼•å‘å„ç§èº«ä½“é—®é¢˜ã€‚ä¸å…¶ç­‰èº«ä½“å˜å·®å†è¡¥æ•‘ï¼Œä¸å¦‚è¶ç°åœ¨åŠæ—¶è°ƒç†ï¼ŒæŠŠé—®é¢˜è§£å†³åœ¨èŒèŠ½é˜¶æ®µï¼
"""
    return result_text

# ---------------------- ç½‘é¡µç•Œé¢ ----------------------
st.set_page_config(page_title="äº”è¡Œèƒ½é‡çŠ¶æ€æµ‹è¯„", layout="wide")
st.title("äº”è¡Œèƒ½é‡çŠ¶æ€æµ‹è¯„")
st.markdown("### å¡«å†™è¯´æ˜ï¼šè¯·æ ¹æ®è¿‘3ä¸ªæœˆçš„èº«ä½“çŠ¶æ€ï¼Œé€‰æ‹©å¯¹åº”ç¨‹åº¦")
st.divider()

answers = {}
col1, col2 = st.columns(2, gap="medium")

# åªæ˜¾ç¤ºé¢˜ç›®ï¼Œä¸æ˜¾ç¤ºä»»ä½•å†…éƒ¨æ ‡ç­¾ï¼ï¼
for qno in sorted(QUESTIONS.keys()):
    qtext, _ = QUESTIONS[qno]
    if qno % 2 == 1:
        with col1:
            s = st.radio(
                f"{qno}. {qtext}",
                options=[1,2,3,4,5],
                format_func=lambda x: ["å®Œå…¨æ²¡æœ‰","è½»åº¦","ä¸­åº¦","ä¸¥é‡","å¾ˆä¸¥é‡"][x-1],
                key=f"q{qno}",
                horizontal=True
            )
            answers[qno] = s
    else:
        with col2:
            s = st.radio(
                f"{qno}. {qtext}",
                options=[1,2,3,4,5],
                format_func=lambda x: ["å®Œå…¨æ²¡æœ‰","è½»åº¦","ä¸­åº¦","ä¸¥é‡","å¾ˆä¸¥é‡"][x-1],
                key=f"q{qno}",
                horizontal=True
            )
            answers[qno] = s

st.divider()
if st.button("æäº¤æµ‹è¯„ Â· æŸ¥çœ‹ç»“æœ", type="primary", use_container_width=True):
    txt = calculate_result(answers)
    st.markdown("---")
    with st.container(border=True):
        st.markdown(txt)