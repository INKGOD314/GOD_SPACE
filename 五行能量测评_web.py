import streamlit as st

# ---------------------- æ ¸å¿ƒé…ç½® ----------------------
# äº”è„å·²æ›¿æ¢ä¸ºäº”è¡Œï¼šå¿ƒ=ç«ã€è‚=æœ¨ã€è„¾=åœŸã€è‚º=é‡‘ã€è‚¾=æ°´
# æ ‡ç­¾å·²æ›¿æ¢ä¸ºï¼šèƒ½é‡è¿‡å¼±/èƒ½é‡è¿‡å¼º
QUESTIONS = {
    1: ["å¿ƒæ…Œå¿ƒæ‚¸ã€èƒ¸å£å‘é—·ï¼Œé‡åˆ°å¤©å†·æˆ–å¹å†·é£åä¼šæ˜æ˜¾åŠ é‡", "ç«èƒ½é‡è¿‡å¼±"],
    2: ["å¿ƒèƒ¸éƒ¨ä½æ€»è§‰å¾—æ€•å†·ï¼Œæ¯”èº«ä½“å…¶ä»–éƒ¨ä½æ›´æ€•å‡‰ï¼Œéœ€è¦é¢å¤–ä¿æš–", "ç«èƒ½é‡è¿‡å¼±"],
    3: ["æ²¡æ€ä¹ˆæ´»åŠ¨å°±å®¹æ˜“å‡ºè™šæ±—ï¼ŒåŒæ—¶ä¼´éšå¿ƒæ…Œã€æ°”çŸ­ã€ç²¾ç¥ä¸æŒ¯", "ç«èƒ½é‡è¿‡å¼±"],
    4: ["å¤œé‡Œå®¹æ˜“æƒŠé†’ã€å¤šæ¢¦ï¼Œä¼´éšå¿ƒæ…Œä¸å®‰ï¼Œæ‰‹è„šå†°å‡‰", "ç«èƒ½é‡è¿‡å¼±"],
    5: ["å¿ƒçƒ¦æ„ä¹±ã€å¿ƒè·³è¿‡å¿«ï¼Œå¤±çœ å¤šæ¢¦ã€å®¹æ˜“é†’ï¼Œå¤œé‡Œç¡è§‰å‡ºæ±—ï¼ˆç›—æ±—ï¼‰", "ç«èƒ½é‡è¿‡å¼º"],
    6: ["èˆŒå°–å‘çº¢ã€åå¤é•¿å£è…”æºƒç–¡/å£èˆŒç”Ÿç–®ï¼Œå£å¹²èˆŒç‡¥ï¼Œå–æ°´ä¹Ÿéš¾ç¼“è§£", "ç«èƒ½é‡è¿‡å¼º"],
    7: ["æ‰‹å¿ƒè„šå¿ƒå‘çƒ­ï¼Œåˆåä¼šè§‰å¾—èƒ¸å£é˜µé˜µå‘çƒ­ï¼Œä¼´éšå¤´æ™•ã€å¥å¿˜", "ç«èƒ½é‡è¿‡å¼º"],
    8: ["å®¹æ˜“è«åå¿ƒæ…Œã€ç„¦è™‘ï¼Œä¸€ç‚¹å°äº‹å°±å¿ƒçƒ¦ï¼Œåç«‹éš¾å®‰", "ç«èƒ½é‡è¿‡å¼º"],
    9: ["èƒè‚‹éƒ¨ä½ï¼ˆèƒ¸å£ä¸¤ä¾§ï¼‰éšéšèƒ€ç—›ï¼Œé‡åˆ°å¤©å†·ã€æƒ…ç»ªä½è½æ—¶ä¼šåŠ é‡", "æœ¨èƒ½é‡è¿‡å¼±"],
    10: ["å°è…¹å†·ç—›ã€å èƒ€ï¼Œå¥³æ€§ç»æœŸå®«å¯’ç—›ç»ã€æœ‰è¡€å—ï¼Œé‡çƒ­ä¼šç¼“è§£", "æœ¨èƒ½é‡è¿‡å¼±"],
    11: ["æƒ…ç»ªä½è½ã€æ€»æä¸èµ·åŠ²ï¼Œå®¹æ˜“èƒ†æ€¯ã€å®³æ€•ï¼Œé‡äº‹ä¸æ•¢åšå†³å®š", "æœ¨èƒ½é‡è¿‡å¼±"],
    12: ["æ‰‹è„šéº»æœ¨ã€ç­‹è„‰å‘ç´§ï¼Œå¤©å†·æ—¶ä¼šåŠ é‡ï¼Œçœ‹ä¸œè¥¿æ€»è§‰å¾—æ¨¡ç³Šã€è§†åŠ›ä¸‹é™", "æœ¨èƒ½é‡è¿‡å¼±"],
    13: ["çœ¼ç›å¹²æ¶©ã€å‘ç–¼ï¼Œçœ‹ä¸œè¥¿æ¨¡ç³Šï¼Œæ€»è§‰å¾—çœ¼å†…æœ‰å¼‚ç‰©ï¼Œç”¨çœ¼ååŠ é‡", "æœ¨èƒ½é‡è¿‡å¼º"],
    14: ["èƒè‚‹éƒ¨ä½éšéšç¼ç—›ï¼Œä¸€ç‚¹å°äº‹å°±æ€¥èºæ˜“æ€’ã€æ§åˆ¶ä¸ä½å‘è„¾æ°”", "æœ¨èƒ½é‡è¿‡å¼º"],
    15: ["å¤´æ™•ç›®çœ©ã€è€³é¸£ï¼Œæ‰‹è„šè½»å¾®å‘éº»ã€ä¸è‡ªè§‰æŠ½åŠ¨ï¼Œä¼´éšæ½®çƒ­ç›—æ±—", "æœ¨èƒ½é‡è¿‡å¼º"],
    16: ["å£å¹²å’½ç‡¥ï¼Œå˜´å”‡å¹²è£‚ï¼Œè„¾æ°”æ€¥èºï¼Œå¤œé‡Œç¡è§‰å¤šæ¢¦ã€æ˜“é†’", "æœ¨èƒ½é‡è¿‡å¼º"],
    17: ["è…¹éƒ¨å†·ç—›ï¼Œæ€»å–œæ¬¢ç”¨çƒ­æ°´è¢‹æ‚ç€ï¼Œåƒç”Ÿå†·é£Ÿç‰©åç«‹åˆ»åŠ é‡", "åœŸèƒ½é‡è¿‡å¼±"],
    18: ["å¤§ä¾¿æºç¨€ã€ä¸æˆå½¢ï¼Œç”šè‡³å¤§ä¾¿é‡Œæœ‰æœªæ¶ˆåŒ–çš„é£Ÿç‰©æ®‹æ¸£ï¼Œåƒå‡‰å°±æ‹‰è‚šå­", "åœŸèƒ½é‡è¿‡å¼±"],
    19: ["é£Ÿæ¬²ä¸æŒ¯ã€é¥­åè‚šå­èƒ€å¾—å‰å®³ï¼Œå››è‚¢ä¸æ¸©ã€æ‰‹è„šå¸¸å¹´å†°å‡‰", "åœŸèƒ½é‡è¿‡å¼±"],
    20: ["èº«ä½“ä¹åŠ›ã€æ‡’å¾—è¯´è¯ï¼Œé¢è‰²èé»„ï¼Œç”šè‡³å‡ºç°å››è‚¢ã€é¢éƒ¨è½»å¾®æµ®è‚¿", "åœŸèƒ½é‡è¿‡å¼±"],
    21: ["è‚šå­éšéšç¼ç—›ï¼Œæ€»è§‰å¾—é¥¿ä½†åˆä¸æƒ³åƒä¸œè¥¿ï¼Œèƒƒé‡Œå˜ˆæ‚ä¸èˆ’æœ", "åœŸèƒ½é‡è¿‡å¼º"],
    22: ["å¤§ä¾¿å¹²ç»“ã€åƒç¾Šå±çŠ¶ï¼Œæ’ä¾¿å›°éš¾ï¼Œå£å¹²å’½ç‡¥ã€å˜´å”‡åå¤å¹²è£‚", "åœŸèƒ½é‡è¿‡å¼º"],
    23: ["æ‰‹å¿ƒè„šå¿ƒå‘çƒ­ï¼Œåˆåèº«ä½“é˜µé˜µå‘çƒ­ï¼Œåƒä¸€ç‚¹æ¸©çƒ­çš„é£Ÿç‰©å°±è§‰å¾—ä¸Šç«", "åœŸèƒ½é‡è¿‡å¼º"],
    24: ["é•¿æœŸå£å¹²ï¼Œå–æ°´åªèƒ½çŸ­æš‚ç¼“è§£ï¼Œä¼´éšæ¶ˆåŒ–ä¸è‰¯ã€èº«ä½“æ¶ˆç˜¦", "åœŸèƒ½é‡è¿‡å¼º"],
    25: ["å’³å—½ã€å–˜æ°”æ— åŠ›ï¼Œç—°ç™½æ¸…ç¨€ã€é‡å¤šï¼Œå¤©å†·ã€å¹å†·é£åç«‹åˆ»åŠ é‡", "é‡‘èƒ½é‡è¿‡å¼±"],
    26: ["èƒŒéƒ¨ç‰¹åˆ«æ€•å†·ï¼Œæ¯”åˆ«äººç©¿å¾—å¤šï¼Œä¸€å¹å†·é£å°±æ„Ÿå†’ã€é¼»å¡æµæ¸…æ¶•", "é‡‘èƒ½é‡è¿‡å¼±"],
    27: ["æ°”çŸ­æ‡’è¨€ã€è¯´è¯å£°éŸ³ä½å¾®ï¼Œç¨å¾®æ´»åŠ¨å°±æ°”å–˜ã€å‡ºè™šæ±—", "é‡‘èƒ½é‡è¿‡å¼±"],
    28: ["å¸¸å¹´åå¤æ„Ÿå†’ï¼Œå…ç–«åŠ›å·®ï¼Œæ„Ÿå†’åå¾ˆé•¿æ—¶é—´éƒ½å¥½ä¸äº†", "é‡‘èƒ½é‡è¿‡å¼±"],
    29: ["å¹²å’³æ— ç—°ï¼Œæˆ–è€…ç—°å°‘è€Œé»ã€å¾ˆéš¾å’³å‡ºæ¥ï¼Œç”šè‡³ç—°é‡Œå¸¦æœ‰å°‘é‡è¡€ä¸", "é‡‘èƒ½é‡è¿‡å¼º"],
    30: ["å’½å–‰å¹²ç—›ã€å£°éŸ³å˜¶å“‘ï¼Œæ€»è§‰å¾—å–‰å’™é‡Œæœ‰å¼‚ç‰©ï¼Œå–æ°´ä¹Ÿç¼“è§£ä¸äº†", "é‡‘èƒ½é‡è¿‡å¼º"],
    31: ["åˆåé¢§éª¨å‘çº¢ã€èº«ä½“æ½®çƒ­ï¼Œå¤œé‡Œç¡è§‰ç›—æ±—ï¼Œæ‰‹å¿ƒè„šå¿ƒå‘çƒ­", "é‡‘èƒ½é‡è¿‡å¼º"],
    32: ["åå¤å’½å–‰è‚¿ç—›ã€é¼»è…”å¹²ç‡¥å‡ºè¡€ï¼Œç§‹å†¬å­£èŠ‚ç—‡çŠ¶ä¼šæ˜æ˜¾åŠ é‡", "é‡‘èƒ½é‡è¿‡å¼º"],
    33: ["è…°è†é…¸è½¯ã€å†·ç—›ï¼Œç•å¯’è‚¢å†·ï¼Œå°¤å…¶æ˜¯è…°å’Œä¸‹è‚¢ï¼Œæ¯”å…¶ä»–éƒ¨ä½æ›´æ€•å†·", "æ°´èƒ½é‡è¿‡å¼±"],
    34: ["å°ä¾¿æ¸…é•¿ã€é‡å¤šï¼Œå¤œé‡Œé¢‘ç¹èµ·å¤œä¸Šå•æ‰€ï¼Œç”šè‡³å‡ºç°å°ä¾¿å¤±ç¦", "æ°´èƒ½é‡è¿‡å¼±"],
    35: ["ç²¾ç¥èé¡ã€æ€»æƒ³ç¡è§‰ï¼Œç”·æ€§é˜³ç—¿æ—©æ³„ï¼Œå¥³æ€§å®«å¯’ã€æœˆç»é‡å°‘å‘é»‘", "æ°´èƒ½é‡è¿‡å¼±"],
    36: ["å¤©ä¸äº®å°±æ‹‰è‚šå­ï¼ˆäº”æ›´æ³»ï¼‰ï¼Œå¤§ä¾¿é‡Œæœ‰æœªæ¶ˆåŒ–çš„é£Ÿç‰©ï¼Œä¼´éšä¸‹è‚¢æµ®è‚¿", "æ°´èƒ½é‡è¿‡å¼±"],
    37: ["è…°è†é…¸ç—›ã€æ— åŠ›ï¼Œçœ©æ™•è€³é¸£ï¼Œè®°å¿†åŠ›æ˜æ˜¾ä¸‹é™ã€æ³¨æ„åŠ›ä¸é›†ä¸­", "æ°´èƒ½é‡è¿‡å¼º"],
    38: ["æ½®çƒ­ç›—æ±—ã€äº”å¿ƒçƒ¦çƒ­ï¼Œåˆåã€å¤œé‡Œèº«ä½“å‘çƒ­ï¼Œé¢§éª¨å‘çº¢", "æ°´èƒ½é‡è¿‡å¼º"],
    39: ["å¤±çœ å¤šæ¢¦ã€å¤œé‡Œæ˜“é†’ï¼Œç”·æ€§é—ç²¾æ—©æ³„ï¼Œå¥³æ€§æœˆç»é‡å°‘ã€ç”šè‡³é—­ç»", "æ°´èƒ½é‡è¿‡å¼º"],
    40: ["å£å¹²å’½ç‡¥ã€å°ä¾¿çŸ­é»„ï¼Œå¤´å‘æ—©ç™½ã€è„±è½ï¼Œä¼´éšå¤´æ™•è€³é¸£", "æ°´èƒ½é‡è¿‡å¼º"],
}

# TAG_GROUPSåŒæ­¥æ›¿æ¢ä¸ºäº”è¡Œ+èƒ½é‡çŠ¶æ€
TAG_GROUPS = {
    "ç«èƒ½é‡è¿‡å¼±": [1,2,3,4],
    "ç«èƒ½é‡è¿‡å¼º": [5,6,7,8],
    "æœ¨èƒ½é‡è¿‡å¼±": [9,10,11,12],
    "æœ¨èƒ½é‡è¿‡å¼º": [13,14,15,16],
    "åœŸèƒ½é‡è¿‡å¼±": [17,18,19,20],
    "åœŸèƒ½é‡è¿‡å¼º": [21,22,23,24],
    "é‡‘èƒ½é‡è¿‡å¼±": [25,26,27,28],
    "é‡‘èƒ½é‡è¿‡å¼º": [29,30,31,32],
    "æ°´èƒ½é‡è¿‡å¼±": [33,34,35,36],
    "æ°´èƒ½é‡è¿‡å¼º": [37,38,39,40],
}

# ---------------------- æ ¸å¿ƒè¿ç®—é€»è¾‘ ----------------------
def calculate_result(answers):
    # 1. åˆå§‹åŒ–å„æ ‡ç­¾å¾—åˆ†
    tag_scores = {tag: 0 for tag in TAG_GROUPS.keys()}
    for tag, qnos in TAG_GROUPS.items():
        for qno in qnos:
            tag_scores[tag] += answers.get(qno, 1)  # é»˜è®¤1åˆ†ï¼ˆå®Œå…¨æ²¡æœ‰ï¼‰
    
    # 2. åˆ¤å®šæ¯ä¸ªäº”è¡Œçš„èƒ½é‡çŠ¶æ€
    organ_results = {}
    # è¿™é‡Œçš„åˆ—è¡¨å·²æ›¿æ¢ä¸ºäº”è¡Œï¼šç«ã€æœ¨ã€åœŸã€é‡‘ã€æ°´
    elements = ["ç«", "æœ¨", "åœŸ", "é‡‘", "æ°´"]
    for ele in elements:
        # åŒ¹é…æ–°çš„é”®åï¼šäº”è¡Œ+èƒ½é‡è¿‡å¼±/è¿‡å¼º
        weak_score = tag_scores[f"{ele}èƒ½é‡è¿‡å¼±"]
        strong_score = tag_scores[f"{ele}èƒ½é‡è¿‡å¼º"]
        
        if weak_score >= 12 and (weak_score - strong_score) >= 4:
            organ_results[ele] = {"ç±»å‹": "èƒ½é‡è¿‡å¼±", "å¾—åˆ†": weak_score}
        elif strong_score >= 12 and (strong_score - weak_score) >= 4:
            organ_results[ele] = {"ç±»å‹": "èƒ½é‡è¿‡å¼º", "å¾—åˆ†": strong_score}
        elif weak_score >= 12 and strong_score >= 12 and abs(weak_score - strong_score) < 4:
            organ_results[ele] = {"ç±»å‹": "èƒ½é‡æ··ä¹±", "å¾—åˆ†": max(weak_score, strong_score)}
        else:
            organ_results[ele] = {"ç±»å‹": "èƒ½é‡å¹³è¡¡", "å¾—åˆ†": 0}
    
    # 3. ç­›é€‰æœ‰å¼‚å¸¸çš„äº”è¡Œå¹¶æ’åºï¼ˆå¾—åˆ†ä»é«˜åˆ°ä½ï¼‰
    biased_eles = [(ele, res) for ele, res in organ_results.items() if res["ç±»å‹"] != "èƒ½é‡å¹³è¡¡"]
    biased_eles.sort(key=lambda x: x[1]["å¾—åˆ†"], reverse=True)
    
    # 4. ç”Ÿæˆç»“æœæ–‡æœ¬ï¼ˆå…¨äº”è¡Œè¡¨è¿°ï¼‰
    result_text = "### äº”è¡Œèƒ½é‡çŠ¶æ€æµ‹è¯„ç»“æœ\n\n"
    if not biased_eles:
        result_text += "âœ… æ‚¨çš„äº”è¡Œèƒ½é‡åŸºæœ¬å¹³è¡¡ï¼Œæ— æ˜æ˜¾å¼‚å¸¸ã€‚\n"
    else:
        result_text += "ğŸ” æ ¸å¿ƒé—®é¢˜æ–¹å‘ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰ï¼š\n"
        for i, (ele, res) in enumerate(biased_eles[:2], 1):
            result_text += f"{i}. {ele}ï¼š{res['ç±»å‹']}ï¼ˆå¾—åˆ†ï¼š{res['å¾—åˆ†']}ï¼‰\n"
        
        # è¡¥å……å…¶ä»–æœ‰å¼‚å¸¸çš„äº”è¡Œ
        if len(biased_eles) > 2:
            result_text += "\nğŸŸ¡ æ¬¡è¦è°ƒç†æ–¹å‘ï¼š\n"
            for ele, res in biased_eles[2:]:
                result_text += f"- {ele}ï¼š{res['ç±»å‹']}ï¼ˆå¾—åˆ†ï¼š{res['å¾—åˆ†']}ï¼‰\n"
    
    result_text += "\nğŸ“Œ è¯´æ˜ï¼šæœ¬ç»“æœä¸ºèº«ä½“çŠ¶æ€åˆç­›ï¼Œä¸å¯æ›¿ä»£ä¸“ä¸šåŒ»å¸ˆé¢è¯Šã€‚"
    return result_text

# ---------------------- ç½‘é¡µç•Œé¢ ----------------------
st.set_page_config(page_title="äº”è¡Œèƒ½é‡çŠ¶æ€æµ‹è¯„", layout="wide")
st.title("äº”è¡Œèƒ½é‡çŠ¶æ€æµ‹è¯„å·¥å…·")
st.markdown("### å¡«å†™è¯´æ˜ï¼šè¯·ç»“åˆè¿‘3ä¸ªæœˆçš„èº«ä½“çŠ¶æ€ï¼Œé€‰æ‹©æ¯é¢˜ç¬¦åˆæ‚¨çš„æƒ…å†µ")

# å­˜å‚¨ç­”æ¡ˆ
answers = {}
# åˆ†æ æ˜¾ç¤ºé¢˜ç›®ï¼ˆæ›´é€‚é…æ‰‹æœºï¼‰
col1, col2 = st.columns(2)
for idx, (qno, (qtext, tag)) in enumerate(QUESTIONS.items()):
    with col1 if idx % 2 == 0 else col2:
        # st.radioå‚æ•°ï¼ˆå·²ä¿®å¤ï¼‰
        score = st.radio(
            f"{qno}. {qtext}",
            options=[
                (1, "å®Œå…¨æ²¡æœ‰"),
                (2, "å¶å°”å‡ºç°"),
                (3, "æœ‰æ—¶å‡ºç°"),
                (4, "ç»å¸¸å‡ºç°"),
                (5, "æ€»æ˜¯å‡ºç°")
            ],
            format_func=lambda x: x[1],  # åªæ˜¾ç¤ºæ–‡æœ¬éƒ¨åˆ†
            key=f"q{qno}",
            horizontal=True
        )
        # å–å…ƒç»„ä¸­çš„æ•°å€¼ä½œä¸ºå¾—åˆ†
        answers[qno] = score[0]

# æäº¤æŒ‰é’®
if st.button("æäº¤æµ‹è¯„", type="primary"):
    result_text = calculate_result(answers)
    st.markdown("---")
    st.markdown(result_text)